"use strict";(()=>{var e={};e.id=9146,e.ids=[9146],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},67214:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>I,patchFetch:()=>R,requestAsyncStorage:()=>h,routeModule:()=>y,serverHooks:()=>f,staticGenerationAsyncStorage:()=>T});var n={};t.r(n),t.d(n,{GET:()=>g,POST:()=>P});var o=t(73278),a=t(45002),s=t(54877),i=t(71309),d=t(48948),u=t(60742),c=t(66368),p=t(13305),l=t(1656),m=t(84770),S=t.n(m),O=t(61866);let _=p.Ryn({customer:p.Ryn({name:p.Z_8().min(1),email:p.Z_8().email(),phone:p.Z_8().optional(),address:p.Ryn({street:p.Z_8(),city:p.Z_8(),state:p.Z_8(),zip:p.Z_8(),country:p.Z_8()})}),items:p.IXX(p.Ryn({product:p.Z_8(),quantity:p.Rxh().min(1),price:p.Rxh(),name:p.Z_8(),image:p.Z_8().optional()})),total:p.Rxh(),paymentInfo:p.Ryn({method:p.Z_8(),transactionId:p.Z_8().optional(),status:p.Z_8().optional()})});async function g(e){try{let r=new URL(e.url),t=r.searchParams.get("orderId"),n=r.searchParams.get("trackingId");if(await (0,d.u)(),t){let e=await u.Z.findOne({orderId:t}).populate("customer");return i.NextResponse.json(e)}if(n){let e=await u.Z.findOne({trackingId:n}).populate("customer");return i.NextResponse.json(e)}let o=await u.Z.find().populate("customer").sort({createdAt:-1});return i.NextResponse.json(o)}catch(e){return i.NextResponse.json({error:"Failed to fetch orders"},{status:500})}}async function P(e){try{let r=await e.json(),t=_.safeParse(r);if(!t.success)return i.NextResponse.json({error:t.error.issues},{status:400});let{customer:n,items:o,total:a,paymentInfo:s}=t.data;if(!O.O.MONGODB_URI){let e=S().randomUUID?S().randomUUID():`TRK-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,r=`PF-${new Date().toISOString().slice(0,10).replace(/-/g,"")}-${Math.random().toString(36).slice(2,6).toUpperCase()}`,t={_id:e,trackingId:e,orderId:r,customer:{...n},items:o,total:a,paymentInfo:s,shippingAddress:n.address,status:"Pending",statusHistory:[{status:"Pending",date:new Date}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{await (0,l.l)(n.email,`Your Perfumify order is received – Order ID ${r}`,`Hi ${n.name}, your order has been received.

Order ID: ${r}
Tracking: ${e}`)}catch{}try{await (0,l.L)("New Order Received (DEV mode)",`Tracking: ${e}  Total: \xa3${a}`)}catch{}return i.NextResponse.json(t,{status:201})}await (0,d.u)();let p=await c.Z.findOne({email:n.email});p?(p.name=n.name,p.phone=n.phone,p.address=n.address,await p.save()):p=await c.Z.create(n);let m=S().randomUUID?S().randomUUID():`TRK-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,g=`PF-${new Date().toISOString().slice(0,10).replace(/-/g,"")}-${Math.random().toString(36).slice(2,6).toUpperCase()}`,P=o.map(e=>{let r={quantity:e.quantity,price:e.price,name:e.name,image:e.image};return e.product&&/^[a-f\d]{24}$/i.test(String(e.product))&&(r.product=e.product),r}),y=await u.Z.create({trackingId:m,orderId:g,customer:p._id,items:P,total:a,paymentInfo:s,shippingAddress:n.address,status:"Pending",statusHistory:[{status:"Pending",date:new Date}]});p.orders.push(y._id),await p.save();let h=`Your Perfumify order is received – Order ID ${g}`,T=`Hi ${n.name},

Thank you for your order.

Order total: \xa3${a}
Order ID: ${g}
Tracking ID: ${m}
Status: Pending

Keep this Order ID to track your order or contact support.

— Perfumify`;try{await (0,l.l)(n.email,h,T)}catch{}try{await (0,l.L)("New Order Received",`Tracking: ${m}  Total: \xa3${a}`)}catch{}return i.NextResponse.json(y,{status:201})}catch(r){console.error("Order create error:",r);let e=r?.message||"Failed to create order";return i.NextResponse.json({error:e},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"C:\\Users\\SMART TECH\\Desktop\\perfumeStore\\src\\app\\api\\orders\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:T,serverHooks:f}=y,I="/api/orders/route";function R(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:T})}},48948:(e,r,t)=>{t.d(r,{u:()=>s});var n=t(11185),o=t.n(n),a=t(61866);async function s(){let e=a.O.MONGODB_URI;if(o().connection?.readyState===1&&e)try{let r=e.match(/@([^/]+)/),t=r?.[1]||"",n=o().connection?.host||"";t&&n&&!n.includes(t)&&(await o().disconnect(),global._mongooseConnection=void 0)}catch{}if(!global._mongooseConnection){if(!a.O.MONGODB_URI)throw Error("MONGODB_URI is not defined in environment variables");let e=a.O.MONGODB_URI;global._mongooseConnection=o().connect(e,{autoIndex:!0}).catch(e=>{throw console.error("MongoDB connection failed:",e?.message),e})}return global._mongooseConnection}},61866:(e,r,t)=>{t.d(r,{O:()=>a});var n=t(13305);let o=n.Ryn({NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME:n.Z_8().min(1),NEXT_PUBLIC_CLOUDINARY_API_KEY:n.Z_8().min(1),NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET:n.Z_8().min(1).default("perfume_store"),CLOUDINARY_API_SECRET:n.Z_8().optional(),MONGODB_URI:n.Z_8().optional(),ADMIN_SECRET_TOKEN:n.Z_8().optional(),SMTP_HOST:n.Z_8().optional(),SMTP_PORT:n.oQ2.number().optional(),SMTP_USER:n.Z_8().optional(),SMTP_PASS:n.Z_8().optional(),NOTIFY_EMAIL:n.Z_8().optional()}).safeParse(process.env);if(!o.success)throw console.error("❌ Invalid environment variables:",o.error.flatten().fieldErrors),Error("Invalid environment variables – check .env");let a=o.success?o.data:{}},1656:(e,r,t)=>{t.d(r,{L:()=>a,l:()=>s});var n=t(56742),o=t(61866);async function a(e,r){try{if(!o.O.SMTP_HOST||!o.O.SMTP_PORT||!o.O.SMTP_USER||!o.O.SMTP_PASS||!o.O.NOTIFY_EMAIL)return{skipped:!0};let t=n.createTransport({host:o.O.SMTP_HOST,port:o.O.SMTP_PORT,secure:!1,auth:{user:o.O.SMTP_USER,pass:o.O.SMTP_PASS}});return await t.sendMail({from:`Perfumify <${o.O.SMTP_USER}>`,to:o.O.NOTIFY_EMAIL,subject:e,text:r}),{sent:!0}}catch(e){return console.error("Email send error",e),{error:!0}}}async function s(e,r,t){try{if(!o.O.SMTP_HOST||!o.O.SMTP_PORT||!o.O.SMTP_USER||!o.O.SMTP_PASS)return{skipped:!0};let a=n.createTransport({host:o.O.SMTP_HOST,port:o.O.SMTP_PORT,secure:!1,auth:{user:o.O.SMTP_USER,pass:o.O.SMTP_PASS}});return await a.sendMail({from:`Perfumify <${o.O.SMTP_USER}>`,to:e,subject:r,text:t}),{sent:!0}}catch(e){return console.error("Customer email send error",e),{error:!0}}}},66368:(e,r,t)=>{t.d(r,{Z:()=>s});var n=t(11185),o=t.n(n);let a=new(o()).Schema({name:{type:String,required:!0,trim:!0},email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},phone:{type:String},address:{street:String,city:String,state:String,zip:String,country:String},orders:[{type:o().Schema.Types.ObjectId,ref:"Order"}]},{timestamps:!0}),s=o().models.Customer||o().model("Customer",a)},60742:(e,r,t)=>{t.d(r,{Z:()=>s});var n=t(11185),o=t.n(n);let a=new(o()).Schema({orderId:{type:String,unique:!0,index:!0},trackingId:{type:String,unique:!0,index:!0},customer:{type:o().Schema.Types.ObjectId,ref:"Customer",required:!0},items:[{product:{type:o().Schema.Types.ObjectId,ref:"Product",required:!1},quantity:{type:Number,required:!0,min:1},price:{type:Number,required:!0},name:String,image:String}],total:{type:Number,required:!0},status:{type:String,enum:["Pending","Processing","Shipped","Delivered","Cancelled"],default:"Pending"},statusHistory:[{status:{type:String},date:{type:Date,default:Date.now}}],paymentInfo:{method:String,transactionId:String,status:String},shippingAddress:{street:String,city:String,state:String,zip:String,country:String}},{timestamps:!0}),s=o().models.Order||o().model("Order",a)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[7787,3305,4833,6742],()=>t(67214));module.exports=n})();