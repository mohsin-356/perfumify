"use strict";(()=>{var e={};e.id=3898,e.ids=[3898],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},93753:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>x,requestAsyncStorage:()=>_,routeModule:()=>y,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{DELETE:()=>f,GET:()=>c,PUT:()=>g});var o=r(73278),i=r(45002),a=r(54877),s=r(71309),l=r(48948),d=r(1369),u=r(13305);let p=u.Ryn({name:u.Z_8().min(1).optional(),slug:u.Z_8().min(1).optional(),description:u.Z_8().optional(),shipping_policy:u.Z_8().optional(),refund_policy:u.Z_8().optional(),sale_price:u.Rxh().optional(),price:u.Rxh().min(0).optional(),images:u.IXX(u.Ryn({url:u.Z_8(),public_id:u.Z_8(),width:u.Rxh().optional(),height:u.Rxh().optional()})).optional(),category:u.Z_8().nullable().optional(),brand:u.Z_8().nullable().optional(),categories:u.IXX(u.Z_8()).optional(),gender:u.KmV(["men","women","unisex"]).optional(),stock:u.Rxh().min(0).optional(),sku:u.Z_8().optional(),weight:u.Rxh().optional(),bestSeller:u.O72().optional(),newArrival:u.O72().optional(),featured:u.O72().optional()});async function c(e,{params:t}){try{await (0,l.u)();let e=await d.x.findById(t.id).lean();if(!e||Array.isArray(e))return s.NextResponse.json({error:"Product not found"},{status:404});if(e.brand&&"string"==typeof e.brand){let t=(await r.e(5396).then(r.bind(r,55396))).default,n=await t.findOne({slug:e.brand}).lean();n&&(e.brand=n)}if(e.category&&"string"==typeof e.category){let t=(await r.e(5679).then(r.bind(r,75679))).default,n=await t.findOne({slug:e.category}).lean();n&&(e.category=n)}return s.NextResponse.json(e)}catch(e){return console.error("Fetch product error:",e),s.NextResponse.json({error:"Failed to fetch product",details:e.message},{status:500})}}async function g(e,{params:t}){try{await (0,l.u)();let n=await e.json(),o=p.safeParse(n);if(!o.success)return s.NextResponse.json({error:"Validation failed",details:o.error.issues},{status:400});let i=await d.x.findById(t.id);if(!i)return s.NextResponse.json({error:"Product not found"},{status:404});if(n.slug&&n.slug!==i.slug&&await d.x.findOne({slug:n.slug,_id:{$ne:t.id}}))return s.NextResponse.json({error:"Product with this slug already exists"},{status:400});let a={...o.data},u=e=>"string"==typeof e&&/^[a-fA-F0-9]{24}$/.test(e);if(a.brand&&u(a.brand)){let e=(await r.e(5396).then(r.bind(r,55396))).default,t=await e.findById(a.brand);t&&(a.brand=t.slug)}if(a.category&&u(a.category)){let e=(await r.e(5679).then(r.bind(r,75679))).default,t=await e.findById(a.category);t&&(a.category=t.slug)}if(Array.isArray(a.categories)&&a.categories.length){let e=(await r.e(5679).then(r.bind(r,75679))).default,t=a.categories.filter(e=>u(e)),n=a.categories.filter(e=>!u(e));if(t.length){let r=await e.find({_id:{$in:t}}).select("slug").lean();n=n.concat(r.map(e=>e.slug))}a.categories=n}let c=await d.x.findByIdAndUpdate(t.id,a,{new:!0});return s.NextResponse.json({success:!0,product:c})}catch(e){return console.error("Update product error:",e),s.NextResponse.json({error:"Failed to update product",details:e.message},{status:500})}}async function f(e,{params:t}){try{if(await (0,l.u)(),!await d.x.findByIdAndDelete(t.id))return s.NextResponse.json({error:"Product not found"},{status:404});return s.NextResponse.json({success:!0,message:"Product deleted successfully"})}catch(e){return console.error("Delete product error:",e),s.NextResponse.json({error:"Failed to delete product",details:e.message},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"C:\\Users\\SMART TECH\\Desktop\\perfumeStore\\src\\app\\api\\products\\[id]\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:_,staticGenerationAsyncStorage:m,serverHooks:h}=y,b="/api/products/[id]/route";function x(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},48948:(e,t,r)=>{r.d(t,{u:()=>a});var n=r(11185),o=r.n(n),i=r(61866);async function a(){let e=i.O.MONGODB_URI;if(o().connection?.readyState===1&&e)try{let t=e.match(/@([^/]+)/),r=t?.[1]||"",n=o().connection?.host||"";r&&n&&!n.includes(r)&&(await o().disconnect(),global._mongooseConnection=void 0)}catch{}if(!global._mongooseConnection){if(!i.O.MONGODB_URI)throw Error("MONGODB_URI is not defined in environment variables");let e=i.O.MONGODB_URI;global._mongooseConnection=o().connect(e,{autoIndex:!0}).catch(e=>{throw console.error("MongoDB connection failed:",e?.message),e})}return global._mongooseConnection}},61866:(e,t,r)=>{r.d(t,{O:()=>i});var n=r(13305);let o=n.Ryn({NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME:n.Z_8().min(1),NEXT_PUBLIC_CLOUDINARY_API_KEY:n.Z_8().min(1),NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET:n.Z_8().min(1).default("perfume_store"),CLOUDINARY_API_SECRET:n.Z_8().optional(),MONGODB_URI:n.Z_8().optional(),ADMIN_SECRET_TOKEN:n.Z_8().optional(),SMTP_HOST:n.Z_8().optional(),SMTP_PORT:n.oQ2.number().optional(),SMTP_USER:n.Z_8().optional(),SMTP_PASS:n.Z_8().optional(),NOTIFY_EMAIL:n.Z_8().optional()}).safeParse(process.env);if(!o.success)throw console.error("❌ Invalid environment variables:",o.error.flatten().fieldErrors),Error("Invalid environment variables – check .env");let i=o.success?o.data:{}},1369:(e,t,r)=>{r.d(t,{x:()=>s});var n=r(11185),o=r.n(n);let i=new n.Schema({url:{type:String,required:!0},public_id:{type:String,required:!0},width:{type:Number},height:{type:Number}},{_id:!1}),a=new n.Schema({name:{type:String,required:!0},slug:{type:String,required:!0,unique:!0},description:{type:String},shipping_policy:{type:String},refund_policy:{type:String},sale_price:{type:Number},price:{type:Number,required:!0},images:{type:[i],default:[]},category:{type:String,required:!0},categories:{type:[String],default:[]},brand:{type:String,required:!0},gender:{type:String,enum:["men","women","unisex"],default:"unisex"},stock:{type:Number,default:0},sku:{type:String,unique:!0,sparse:!0},weight:{type:Number},tags:[String],variations:Object,bestSeller:{type:Boolean,default:!1},newArrival:{type:Boolean,default:!1},featured:{type:Boolean,default:!1}},{timestamps:!0}),s=o().models.Product||o().model("Product",a)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7787,3305,4833],()=>r(93753));module.exports=n})();