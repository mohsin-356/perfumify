"use strict";(()=>{var e={};e.id=9684,e.ids=[9684],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},90359:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>S,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{GET:()=>c,POST:()=>g});var n=r(73278),i=r(45002),a=r(54877),s=r(71309),l=r(48948),u=r(1369),p=r(13305);let d=p.Ryn({name:p.Z_8().min(1,"Name is required"),slug:p.Z_8().min(1,"Slug is required"),description:p.Z_8().optional(),shipping_policy:p.Z_8().optional(),refund_policy:p.Z_8().optional(),sale_price:p.Rxh().optional(),price:p.Rxh().min(0,"Price must be positive"),images:p.IXX(p.Ryn({url:p.Z_8(),public_id:p.Z_8(),width:p.Rxh().optional(),height:p.Rxh().optional()})).min(1,"At least one image is required"),category:p.Z_8().nullable().optional(),brand:p.Z_8().nullable().optional(),categories:p.IXX(p.Z_8()).optional(),gender:p.KmV(["men","women","unisex"]).optional(),stock:p.Rxh().min(0).default(0),sku:p.Z_8().optional(),weight:p.Rxh().optional(),bestSeller:p.O72().optional().default(!1),newArrival:p.O72().optional().default(!1),featured:p.O72().optional().default(!1)});async function c(e){try{await (0,l.u)();let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),o=parseInt(t.get("limit")||"20"),n=t.get("search")||"",i=t.get("category"),a=t.get("brand"),p=t.get("gender"),d=t.get("sort")||"-createdAt",c=t.get("bestSeller"),g=t.get("newArrival"),m=t.get("featured"),_={};if("true"===c&&(_.bestSeller=!0),"true"===g&&(_.newArrival=!0),"true"===m&&(_.featured=!0),n&&(_.$or=[{name:{$regex:n,$options:"i"}},{description:{$regex:n,$options:"i"}}]),i){let e=i.split(",").map(e=>e.trim().toLowerCase()),t=[{category:{$in:e}},{categories:{$in:e}}];_.$or?_.$or=[..._.$or,...t]:_.$or=t}if(a){let e=a.split(",").map(e=>e.trim().toLowerCase());_.brand={$in:e}}p&&["men","women","unisex"].includes(p)&&(_.gender=p);let f=(r-1)*o,y=await u.x.find(_).sort(d).skip(f).limit(o).lean(),h=await u.x.countDocuments(_);return s.NextResponse.json({data:y,paginatorInfo:{total:h,currentPage:r,lastPage:Math.ceil(h/o),perPage:o,hasMorePages:r*o<h}})}catch(e){return console.error("Fetch products error:",e),s.NextResponse.json({error:"Failed to fetch products",details:e.message},{status:500})}}async function g(e){try{await (0,l.u)();let t=await e.json(),o=d.safeParse(t);if(!o.success)return s.NextResponse.json({error:"Validation failed",details:o.error.issues},{status:400});let n=o.data;if(await u.x.findOne({slug:n.slug}))return s.NextResponse.json({error:"Product with this slug already exists"},{status:400});if(n.brand){let e=(await r.e(5396).then(r.bind(r,55396))).default,t=await e.findById(n.brand);t&&(n.brand=t.slug)}if(n.category){let e=(await r.e(5679).then(r.bind(r,75679))).default,t=await e.findById(n.category);t&&(n.category=t.slug)}if(Array.isArray(n.categories)&&n.categories.length){let e=(await r.e(5679).then(r.bind(r,75679))).default,t=await e.find({_id:{$in:n.categories}}).select("slug").lean();n.categories=t.map(e=>e.slug)}let i=await u.x.create(n);return s.NextResponse.json({success:!0,product:i},{status:201})}catch(e){return console.error("Create product error:",e),s.NextResponse.json({error:"Failed to create product",details:e.message},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"C:\\Users\\SMART TECH\\Desktop\\perfumeStore\\src\\app\\api\\products\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:_,staticGenerationAsyncStorage:f,serverHooks:y}=m,h="/api/products/route";function S(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},48948:(e,t,r)=>{r.d(t,{u:()=>a});var o=r(11185),n=r.n(o),i=r(61866);async function a(){let e=i.O.MONGODB_URI;if(n().connection?.readyState===1&&e)try{let t=e.match(/@([^/]+)/),r=t?.[1]||"",o=n().connection?.host||"";r&&o&&!o.includes(r)&&(await n().disconnect(),global._mongooseConnection=void 0)}catch{}if(!global._mongooseConnection){if(!i.O.MONGODB_URI)throw Error("MONGODB_URI is not defined in environment variables");let e=i.O.MONGODB_URI;global._mongooseConnection=n().connect(e,{autoIndex:!0}).catch(e=>{throw console.error("MongoDB connection failed:",e?.message),e})}return global._mongooseConnection}},61866:(e,t,r)=>{r.d(t,{O:()=>i});var o=r(13305);let n=o.Ryn({NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME:o.Z_8().min(1),NEXT_PUBLIC_CLOUDINARY_API_KEY:o.Z_8().min(1),NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET:o.Z_8().min(1).default("perfume_store"),CLOUDINARY_API_SECRET:o.Z_8().optional(),MONGODB_URI:o.Z_8().optional(),ADMIN_SECRET_TOKEN:o.Z_8().optional(),SMTP_HOST:o.Z_8().optional(),SMTP_PORT:o.oQ2.number().optional(),SMTP_USER:o.Z_8().optional(),SMTP_PASS:o.Z_8().optional(),NOTIFY_EMAIL:o.Z_8().optional()}).safeParse(process.env);if(!n.success)throw console.error("❌ Invalid environment variables:",n.error.flatten().fieldErrors),Error("Invalid environment variables – check .env");let i=n.success?n.data:{}},1369:(e,t,r)=>{r.d(t,{x:()=>s});var o=r(11185),n=r.n(o);let i=new o.Schema({url:{type:String,required:!0},public_id:{type:String,required:!0},width:{type:Number},height:{type:Number}},{_id:!1}),a=new o.Schema({name:{type:String,required:!0},slug:{type:String,required:!0,unique:!0},description:{type:String},shipping_policy:{type:String},refund_policy:{type:String},sale_price:{type:Number},price:{type:Number,required:!0},images:{type:[i],default:[]},category:{type:String,required:!0},categories:{type:[String],default:[]},brand:{type:String,required:!0},gender:{type:String,enum:["men","women","unisex"],default:"unisex"},stock:{type:Number,default:0},sku:{type:String,unique:!0,sparse:!0},weight:{type:Number},tags:[String],variations:Object,bestSeller:{type:Boolean,default:!1},newArrival:{type:Boolean,default:!1},featured:{type:Boolean,default:!1}},{timestamps:!0}),s=n().models.Product||n().model("Product",a)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7787,3305,4833],()=>r(90359));module.exports=o})();