"use strict";(()=>{var e={};e.id=5998,e.ids=[5998],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},14444:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>I,requestAsyncStorage:()=>c,routeModule:()=>_,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{POST:()=>f,runtime:()=>d});var o=r(73278),i=r(45002),s=r(54877),u=r(71309),n=r(39360);let l=require("sharp");var p=r.n(l);let d="nodejs";async function f(e){let t=e.headers.get("content-type")??"";try{let r;if(t.includes("multipart/form-data")){let t=(await e.formData()).get("file");if(!(t instanceof Blob))return u.NextResponse.json({error:"Missing or invalid file field"},{status:400});let r=await t.arrayBuffer(),a=Buffer.from(r),o=await p()(a).rotate().resize({width:2e3,height:2e3,fit:"inside",withoutEnlargement:!0}).toFormat("webp",{quality:85}).toBuffer(),i=await (0,n.Ix)(o);return u.NextResponse.json({url:i.secure_url,public_id:i.public_id,width:i.width,height:i.height,secure_url:i.secure_url},{status:200})}let a=await e.json().catch(()=>null);if(!a||!a.file)return u.NextResponse.json({error:"Missing file in body (base64 or URL)"},{status:400});let{file:o,...i}=a;if("string"==typeof o&&o.startsWith("data:")){let e=o.match(/^data:(.+);base64,(.*)$/);if(!e)return u.NextResponse.json({error:"Invalid data URI"},{status:400});let t=e[2],a=Buffer.from(t,"base64"),s=await p()(a).rotate().resize({width:2e3,height:2e3,fit:"inside",withoutEnlargement:!0}).toFormat("webp",{quality:85}).toBuffer();r=await (0,n.Ix)(s,i)}else r=await (0,n.Ix)(o,i);return u.NextResponse.json({url:r.secure_url,public_id:r.public_id,width:r.width,height:r.height,secure_url:r.secure_url},{status:200})}catch(e){return console.error("Cloudinary upload error",e),u.NextResponse.json({error:"Upload failed",details:e?.message},{status:500})}}let _=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"C:\\Users\\SMART TECH\\Desktop\\perfumeStore\\src\\app\\api\\upload\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:h,serverHooks:m}=_,v="/api/upload/route";function I(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},39360:(e,t,r)=>{r.d(t,{Ix:()=>s,ao:()=>u,vs:()=>n});var a=r(5482),o=r(61866);a.v2.config({cloud_name:o.O.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,api_key:o.O.NEXT_PUBLIC_CLOUDINARY_API_KEY,api_secret:o.O.CLOUDINARY_API_SECRET,secure:!0});let i={folder:"perfumify",transformation:[{quality:"auto",fetch_format:"auto"}]};async function s(e,t={}){let r={...i,...t};return Buffer.isBuffer(e)?new Promise((t,o)=>{a.v2.uploader.upload_stream(r,(e,r)=>{if(e||!r)return o(e);t(r)}).end(e)}):a.v2.uploader.upload(e,r)}async function u(e){return a.v2.uploader.destroy(e)}function n(e,{width:t,height:r,crop:o="fill",blur:i,quality:s="auto",format:u="auto"}){let n=[{width:t,height:r,crop:o,quality:s,fetch_format:u}];return i&&n.push({effect:`blur:${i}`}),a.v2.url(e,{secure:!0,transformation:n})}},61866:(e,t,r)=>{r.d(t,{O:()=>i});var a=r(13305);let o=a.Ryn({NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME:a.Z_8().min(1),NEXT_PUBLIC_CLOUDINARY_API_KEY:a.Z_8().min(1),NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET:a.Z_8().min(1).default("perfume_store"),CLOUDINARY_API_SECRET:a.Z_8().optional(),MONGODB_URI:a.Z_8().optional(),ADMIN_SECRET_TOKEN:a.Z_8().optional(),SMTP_HOST:a.Z_8().optional(),SMTP_PORT:a.oQ2.number().optional(),SMTP_USER:a.Z_8().optional(),SMTP_PASS:a.Z_8().optional(),NOTIFY_EMAIL:a.Z_8().optional()}).safeParse(process.env);if(!o.success)throw console.error("❌ Invalid environment variables:",o.error.flatten().fieldErrors),Error("Invalid environment variables – check .env");let i=o.success?o.data:{}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7787,3305,4833,5482],()=>r(14444));module.exports=a})();