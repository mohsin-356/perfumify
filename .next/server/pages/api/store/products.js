"use strict";(()=>{var e={};e.id=8793,e.ids=[8793],e.modules={11185:e=>{e.exports=require("mongoose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},89351:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>p,routeModule:()=>g});var n={};r.r(n),r.d(n,{default:()=>d});var a=r(71802),i=r(47153),o=r(56249),s=r(33087),u=r(40122),l=r(46344);async function d(e,t){if("GET"!==e.method)return t.setHeader("Allow","GET"),t.status(405).end("Method Not Allowed");try{let r,n;await (0,s.C)();let a=Math.max(parseInt(String(e.query.page||"1"),10)||1,1),i=Math.min(Math.max(parseInt(String(e.query.limit||"10"),10)||10,1),100),o={status:{$ne:"inactive"}},d=`store:products:${a}:${i}`,p=u.e.get(d);p?(r=p.items,n=p.total,t.setHeader("X-Cache","HIT")):([r,n]=await Promise.all([l.x.find(o,"name brand price sale_price image gallery category quantity status created_at description short_description tags").sort({created_at:-1}).skip((a-1)*i).limit(i).lean(),l.x.countDocuments(o)]),u.e.set(d,{items:r,total:n},3e4),t.setHeader("X-Cache","MISS"));let c=a*i<n;return t.setHeader("Cache-Control","public, max-age=30, stale-while-revalidate=300"),t.status(200).json({data:r,paginatorInfo:{nextPageUrl:c?`page=${a+1}`:"",hasNextPage:c,currentPage:a,total:n}})}catch(e){return t.status(500).json({data:[],paginatorInfo:{nextPageUrl:"",hasNextPage:!1,currentPage:1,total:0}})}}let p=(0,o.l)(n,"default"),c=(0,o.l)(n,"config"),g=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/store/products",pathname:"/api/store/products",bundlePath:"",filename:""},userland:n})},33087:(e,t,r)=>{r.d(t,{C:()=>s});var n=r(11185),a=r.n(n);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable in .env.local");let o=global.__mongooseConn;async function s(){return o.conn||(o.promise||(o.promise=a().connect(i,{bufferCommands:!1,dbName:process.env.MONGODB_DB||"perfumify"})),o.conn=await o.promise),o.conn}o||(o=global.__mongooseConn={conn:null,promise:null})},40122:(e,t,r)=>{r.d(t,{e:()=>a});class n{get(e){let t=this.store.get(e);if(t){if(Date.now()>t.expiry){this.store.delete(e);return}return t.value}}set(e,t,r){this.store.set(e,{value:t,expiry:Date.now()+r})}del(e){this.store.delete(e)}constructor(){this.store=new Map}}let a=new n},46344:(e,t,r)=>{r.d(t,{x:()=>s});var n=r(11185),a=r.n(n);let i=new n.Schema({url:{type:String,required:!0},public_id:{type:String,required:!0},width:{type:Number},height:{type:Number}},{_id:!1}),o=new n.Schema({name:{type:String,required:!0},slug:{type:String,required:!0,unique:!0},description:{type:String},shipping_policy:{type:String},refund_policy:{type:String},sale_price:{type:Number},price:{type:Number,required:!0},images:{type:[i],default:[]},category:{type:String,required:!0},categories:{type:[String],default:[]},brand:{type:String,required:!0},gender:{type:String,enum:["men","women","unisex"],default:"unisex"},stock:{type:Number,default:0},sku:{type:String,unique:!0,sparse:!0},weight:{type:Number},tags:[String],variations:Object,bestSeller:{type:Boolean,default:!1},newArrival:{type:Boolean,default:!1},featured:{type:Boolean,default:!1}},{timestamps:!0}),s=a().models.Product||a().model("Product",o)},47153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=89351);module.exports=r})();